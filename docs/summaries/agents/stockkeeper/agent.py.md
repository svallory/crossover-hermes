# Summary of src/hermes/agents/stockkeeper/agent.py

This file, `agent.py`, contains the core logic for the Stockkeeper agent, also known as the Product Resolver. Its primary function, `resolve_product_mentions`, takes product mentions identified by the Classifier agent and attempts to match them to actual products in the catalog.

Key components and responsibilities:
-   **Product Resolution Strategy:** Implements a cascading resolution strategy within `resolve_product_reference`. It prioritizes an exact match by `product_id`. If unsuccessful, it performs a fuzzy search by `product_name` using a word-overlap similarity (`find_products_by_name`). Product data is accessed via helper functions like `get_product_by_id` and structured using `_create_product_from_row`, operating on a DataFrame loaded by `load_products_df`.
-   **Ambiguity and Deduplication Handling:** Addresses challenges where product mentions might be ambiguous or refer to the same product multiple times. It leverages LLMs through functions like `run_deduplication_llm` (for `deduplicate_mentions`) and `run_disambiguation_llm` (for `disambiguate_with_llm`). These LLM calls enable more nuanced processing, such as merging duplicate mentions and selecting the correct product from multiple candidates based on email context.
-   **Confidence Scoring:** Assigns confidence scores to resolved products, reflecting the reliability of the match (e.g., exact ID matches receive the highest confidence).
-   **Output Generation:** Consolidates the resolved product information into a `StockkeeperOutput` object. This output includes a list of successfully resolved `Product` objects, a list of `ProductMention` objects that could not be resolved, and optional metadata about the resolution process.
-   **Integration with Workflow:** The `resolve_product_mentions` function is designed as a node within the LangGraph workflow. It accepts `StockkeeperInput` (containing product mentions from the Classifier's output) and returns a `WorkflowNodeOutput` wrapping the `StockkeeperOutput` or an error.
-   **Configuration:** Utilizes configurable thresholds (e.g., `EXACT_MATCH_THRESHOLD`, `SIMILAR_MATCH_THRESHOLD`, `AMBIGUITY_THRESHOLD`) to fine-tune the resolution and ambiguity detection logic.

Architecturally, the Stockkeeper agent is a critical intermediary in the Hermes workflow. It bridges the gap between unstructured product mentions extracted by the Classifier and the structured product catalog. By employing a combination of traditional lookup/matching techniques and LLM-powered reasoning for deduplication and disambiguation, it aims to accurately identify the products a customer is referencing. This accurate resolution is essential for downstream agents like the Advisor (for inquiries) and the Fulfiller (for orders).

[Link to source file](../../../../src/hermes/agents/stockkeeper/agent.py) 